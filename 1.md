# 乐视电商云的整体架构与技术实现

## 1\. 电商系统发展过程

电商网站在不同时期的架构复杂度有所不同：

**初创期**：商品类型少，业务复杂度低，系统架构简单。采用高可用数据库、分布式缓存、文件存储等基本组件就可满足需求。

**发展期**：数据量、业务复杂度、系统复杂度、计算资源需求都剧增。则需要业务拆分并独立部署，采用CDN、高可用数据库、分布式缓存、分布式消息队列、分布式文件存储等。

**四大计算资源**：存储、计算、内存、网络带宽

**业务拆分并独立部署**:订单系统、仓库管理系统、购物系统等等都要专门部署

**CDN**：类似分布各地的物流仓储网络，CDN网络可以将源站的内容缓存到分布全球的CDN节点，根据用户的访问IP，就近连接CDN，提高网站响应速度。

**高可用数据库**：经常都可以用，例如一年365天，你要364天都可以用的，能用的时间要占99.9999%

**缓存**：暂时存起来

**分布式和集群**:小饭店原来只有一个厨师，切菜洗菜备料炒菜全干。后来客人多了，厨房一个厨师忙不过来，又请了个厨师，两个厨师都能炒一样的菜，这两个厨师的关系是集群。为了让厨师专心炒菜，把菜做到极致，又请了个配菜师负责切菜，备菜，备料，厨师和配菜师的关系是分布式，一个配菜师也忙不过来了，又请了个配菜师，两个配菜师关系是集群。一个配菜师因故请假了，但是其余的配菜师还是该啥就干啥，可能没请假的配菜师任务会被均匀的加量了，但是他们的任务和职责是不变的--来自知乎


**分布式缓存**：由一个服务端实现管理和控制，有多个客户端节点存储数据

**消息**：消息是指在两个独立的系统间传递的数据，这两个系统可以是两台计算机，也可以是两个进程。消息可以非常简单，可以是简单的字符串，也可以是保存了数据持久化的各种类型的文档集合。

**队列**：本质是一个存储组件，模式是“存进去--取出来”，正式因为这样的过程，所以队列担任的职责就是“缓冲、暂存” --来自驹哥

**解耦**：解耦通俗地说就是两个东西原来互相影响，现在让他们独立发展；核心思想还是最小职责，每个地方都只做一件事情；只要一个地方负责了多项事情，就存在解耦的可能。在系统每个层次都可以体现解耦的思想，比如在架构层面把存储和业务逻辑解耦，把动态页面和静态页面解耦；在模块层面把业务模块和统计模块解耦；在代码层面把多个功能解耦等等。解耦的思想很好，但是没必要为了解耦而解耦，还是要从业务需求以及系统定位出发，满足一段时间内系统发展的需要即可。--来自知乎

**低耦合、高内聚**：解耦通俗地说就是两个东西原来互相影响，现在让他们独立发展；核心思想还是最小职责，每个地方都只做一件事情；只要一个地方负责了多项事情，就存在解耦的可能。在系统每个层次都可以体现解耦的思想，比如在架构层面把存储和业务逻辑解耦，把动态页面和静态页面解耦；在模块层面把业务模块和统计模块解耦；在代码层面把多个功能解耦等等。解耦的思想很好，但是没必要为了解耦而解耦，还是要从业务需求以及系统定位出发，满足一段时间内系统发展的需要即可。--来自知乎

![](http://img.blog.csdn.net/20161001082843766)

**DNS服务器**：域名服务器，解析域名

**负载均衡服务器**："[负载均衡]服务器"是本系统的控制服务器，所有用户的请求都首先到此[服务器]，然后由此服务器根据各个实际处理服务器状态将请求具体分配到某个实际处理服务器中，对外公开的域名与IP地址都是这台服务器。负载均衡控制与管理软件安装在这台服务器上，这台服务器一般只做负载均衡任务分配，但不是实际对网络请求进行处理的服务器。

**正向代理**：是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须要进行一些特别的设置才能使用正向代理。

**反向代理**：反向代理对外都是透明的，访问者者并不知道自己访问的是一个代理。因为客户端不需要任何配置就可以访问。反向代理（Reverse Proxy）实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。

**正向反向个人理解**：正向代理就比如是我们想要访问国外网站，需要挂VPN，VPN这个服务器就是正向代理，反向代理就是渗透测试拿下一个网站的webshell，发现IP是内网的，那么暴露在公网的这个IP服务器就是反向代理

**正向代理就是内网访问外网，反向代理就是外网访问内网**

**反向代理的作用：**

（1）保证内网的安全，可以使用反向代理提供WAF功能，阻止web攻击

大型网站，通常将反向代理作为公网访问地址，Web服务器是内网。

（2）负载均衡，通过反向代理服务器来优化网站的负载

从图可以看到反向代理服务器映射到多个A应用服务器1和B应用服务器1，所以反向代理服务器的作用之一是负载均衡。

问：**为什么反向代理服务器已经起到负载均衡了，为什么还要负载均衡服务器？**
答：**村长管理村，县长管理县，市长管理市，那为什么还需要省长管理省？同样的道理！**

**消息队列服务器**：用来做消息通信，A和B之间进行数据通信，消息交换，可以通过消息队列服务器来传递。

问：**为什么A和B不直接通信呢？消息队列服务器在A和B之间的作用是什么？**
答：解耦。对A来讲，消息队列屏蔽了B，对B来讲，消息队列屏蔽了A。这个时候，A和B存在与不存在影响都不大，假如A从3台变成了30台，对B来讲无任何影响，反之同理。

A和B服务器访问分布式服务器，可能会访问不通分布式服务的服务器，比如访问分布式服务1的服务器2，分布式服务2的服务器1等等。

应用程序在分布式服务器上面运行。

应用程序运行的时候，可能会访问本地缓存（为了提高效率），也可能访问远端的存储服务。

**统一数据访问模块**：做程序要模块化。输入处理输出，计算控制存储，就是模块化。也相当于解耦的功能。有没有远端的分布式缓存，有还是没有，经过数据访问模块，可以屏蔽起来，设计的接口可以是通用的，用sql也好，还是nosql也好，自己可以做选择。

**搜索引擎服务器**：部署elasticsearch集群

**NoSQL服务器**：存储文档化的数据，非结构化。redis、Mongodb

**分布式数据库**：RDS

**分布式文件服务器**：

**分布式缓存服务器**：redis

**本地缓存**：Memcache

**消息队列服务器**：rabbitmq、reids

**应用服务器**：Java服务器、Python服务器、Http服务器

**反向代理服务器**：Nginx

**负载均衡服务器**：Haproxy


## **2\. 高速发展期的电商面临的问题**

**2.1 业务的快速扩张、资源需求快速扩张，但利用率低下**

企业的主要目标是在市场上抢得先机，降低经营成本。传统租用服务器或数据中心的方式对硬件资源、人力资源都要有很大的开支，而且从采购、招人到系统部署上线周期很长，效率低下。

**2.2 系统复杂度的直线上升，耦合严重，牵一发动全身**

随着业务规模的扩大，大部分时间在进行新功能的开发和bug修复，可能没有精力对系统进行及时梳理与重构，导致系统日益庞大与臃肿， 耦合度比较高，牵一发动全身。

甚至有些公用的代码在不同项目中存在多份拷贝，修改一份公有代码后其他的却忘了同步，出问题不好排查，复用率低下。

**2.3 安全性问题愈加严重**

业务做大了以后容易招致DDoS、恶意刷单、恶意渗透、用户隐私泄露等安全风险。在新网络安全法草案的规约中，对电商企业提供服务的安全性也提出了明确的标准。

一般的企业核心在商业市场上，而不是在技术保障上。小微电商或传统电商都难有相应的技术实力去做这些安全保障。

以上问题通过使用电商云可以很好的解决。系统复杂度的问题通过微服务架构来进行处理，资源需求、安全问题通过电商云解决。


## **3\. 架构向微服务化演进**
伴随着网站规模的增大、功能的复杂、服务和数据处理种类的增多，微服务化的架构设计思路逐渐成为了业界的广泛共识。

**推荐以循序渐进的方式拆分，不轻易进行推翻式的重构。**

拆分也要有个度，不是越细越好，主要还是要关注在业务领域，同时注意提取公共组件，进行分层抽象。

**3.1 微服务化的优势：↓**

**微服务：提高效率、
核心：小而自治的系统  高内聚低耦合
至于拆成多微小，主要由团队组织架构确定**

**将服务分割成高内聚低耦合的模块**，有利于软件的开发维护。每个独立团队关注在自己独立的领域里，更加专注于业务。

不同的微服务可以进行分布式部署，可针**对瓶颈模块进行独立弹性伸缩**， 提高系统并发能力。控制粒度更细。

**弹性伸缩**：根据业务需求和伸缩策略，自动调整计算资源。需求量大的时候，我多部署一些，需求量小的时候，我少部署一些。需求量降下去之后，我把需求回收，需求量升上去了，我把资源分配给他。

**瓶颈模块**：比如双十一抢购的时候，下单、支付等等接口都会成为瓶颈。

**3.2 微服务化的劣势**

服务数量增加，加大部署、管理、监控等运维操作的难度与工作量，同时对运维人员的质量与数量也提出了新的要求。

服务内部通信增多，增加依赖关系管理的复杂度。

故障排查的难度增加，一个请求需要经过的处理节点增多。

**在分布式系统中做错误跟踪，在输入处理输出，计算控制存储的关键地方加日志，在报错的地方加trace id可以快速的定位错误。**

**并不是说把一个项目拆分成20个项目就是微服务了，微服务化的根本目的是提升效率而不是降低效率。**


**3.3 电商微服务体系结构**

电商微服务体系结构如下图所示：
![](http://img.blog.csdn.net/20161001082946110)
电商体系可能包含很多子系统， 大致可以归类为三层：

**业务层** 
产品信息、购物车、订单系统、支付系统、抢购、库存、物流系统、评论系统、客服系统、推荐系统等等。

**公共服务层** 
在业务层之下需要有一个公共服务层，这一层专门为业务层提供公共服务。也就是所有业务层或者部分业务层共有的逻辑或者内容需要调用的部分。

**基础组件层** 
业务层面系统依赖一些基础层面组件， 例如：高可用DB、 分布式缓存、分布式消息队列、NoSQL等。基础组件层更偏向PaaS服务，可由电商独立构建，也可以采用已有的云组件提供服务。

**要发挥微服务架构的优势和克服它的缺点，可以通过电商云和容器技术来解决。**


## 话外题：什么是云计算
来自 http://aju.space/2016/08/30/what-is-cloud-compute.html
### 云计算

**云计算是一个实现了无处不在的、方便的、通过网络访问按需取用可配置的计算资源共享池（例如：网络、服务器、存储、应用程序和服务）的模型，用户能以最小的管理成本或与提供商沟通的代价即可快速配置和发布所需的计算资源。**
#### 基本特征

*   **按需自助服务**。客户能单方面地规定他所需的计算能力，比如服务时间和网络存储，便可自动地获得所需要的资源而无需人工参与。

*   **宽带网接入**。服务能力可以基于宽带网通过标准机制访问，而屏蔽异构的瘦客户端或胖客户端平台（例如手机、平板电脑、笔记本电脑和工作站）。

*   **资源池化**。提供商的计算资源被集中起来为多个客户提供多租户模式的服务，不同的物理或虚拟资源按客户需求动态地分配和再分配。还有一种位置独立感，客户一般不能控制也无需知晓被提供的资源的确切位置，但可以让其指定位置更高级别的抽象（如国家、州或数据中心）。资源一般包括存储、计算、内存、网络带宽。

*   **快速伸缩**。服务能力可以在某些情况下自动地弹性调配与发布，规模化地向外扩展或向内收缩以适应需求。对客户而言，可以用于调配的资源能力几乎是无限制的，可以在任意时间任意取用。

*   **服务可计量**。云计算系统通过利用各类服务（如，存储、计算、带宽、活跃用户）在某种级别上相应的抽象的计量能力以自动控制和优化资源使用。资源使用情况可以被监视、控制和报告，对利用服务的提供商和客户两者来说都是透明的。

#### 服务模型

*   **软件即服务（SaaS）：例如买来一个软件用，nas** 客户能使用提供商的应用程序以运行在云计算基础设施之上。这类应用程序可以从各种客户端访问，从瘦客户端到胖客户端，比如通用的Web浏览器（例如基于web的email服务）或者是专用的程序界面。客户不用管理和控制底层的云计算基础设施，包括网络、服务器、操作系统、存储甚至是个别应用程序的功能等，可能例外是需要客户指定应用程序的部分配置信息。

*   **平台即服务（PaaS）：例如新浪的sae。** 客户可以在云计算基础设施上部署客户自己创建的或者购置提供商支持的编程语言、库、服务及工具创建的应用程序。客户不管理或控制云计算底层基础设施，包括网络、服务器、操作系统或存储，但对其部署的应用程序有控制权并可能对应用运行环境的相关配置进行设定。

*   **基础设施即服务（IaaS）：例如服务商卖服务器，如阿里云ECS。** 客户可以规定满足其运行任何软件（包括操作系统和应用程序）所需的计算、存储、网络和其他基本的计算资源。客户不管理或控制云计算底层基础设施，但能控制操作系统、存储和部署的应用；可能对选择网络组件（如防火墙）等具有有限的控制权。

#### 部署模式

*   **私有云** 云计算基础设施提供给包含多个消费者（例如业务单元）组成的单一的独占使用的机构。它可能由这个机构拥有、管理或运营，也可以是第三方或者其他合作方式。这些基础设施可以存放于或不存放于该机构本地。

*   **社区云** 云计算基础设施提供给来自组织中具有共同利益（例如任务、安全要求、政策和法规遵从性等方面考虑）的消费者组成的特定社区独占使用。基础设施被社区中的一个或多个组织拥有、管理及运营，可以存放或不存放于它们的处所。

*   **公有云** 云基础设施提供给一般公众开放使用。它可能被一个企业、学院、政府机构或其他合作形式的组织拥有、管理及运营。它存放于云计算提供商那里。

*   **混合云** 这种是私有云、社区云、公有云的混合组成形式，各部分是独立的实体，但被标准化或专利技术绑定在一起，实现数据和应用程序的可移植性（例如在突发情况下在不同的云之间做负载均衡）。
![](http://7xn3rj.com1.z0.glb.clouddn.com/static/images/cloudstack.png)

## **4\. 乐视电商云**

微服务化的提出比较早，但在云成熟落地后，微服务架构才有了比较好的载体。近年逐渐形成了垂直领域云的风潮，不断推出适合垂直领域的产品，使客户的使用门槛降低，且能提供更多偏向垂直领域中的通用服务，更贴近现实与解决迫切的问题。乐视电商云是针对电商行业提供了一整套帮助企业利用云计算优势的解决办法。

**4.1 电商行业对垂直云的要求**

高性能 
高可用 
良好伸缩性 
方便地拓展性 
安全保证 

**伸缩性**：同一件东西的放大和缩小
**扩展性**：是增加和减少不同的功能

**4.2 电商云的产品形态**

**4.2.1 电商公有云**

比如电商的初级客户，希望快速构建电商系统。在电商公有云只需注册一个账号，即可开通面对电商的完整服务体系。从服务到基础设施无缝衔接，复杂的技术体系与适配硬件设备等工作对客户透明，且可提供带运维的增值服务。

用户访问服务（域名）经 DNS解析，通过DNS轮询做第一次负载均衡，静态资源请求流量会导至离用户地理位置较近的CDN节点。云防护系统先进行流量过滤，清洗无效流量、恶意流 量，拦截攻击行为等安全防护。

电商业务系统推荐以微服务的方式进行架构设计并实施，上述微服务第三层的组件技术层可以采用 PaaS组件服务，如RDS、分布式消息队列、OSS、分布式缓存等。

微服务化的业务通过容器部署在IaaS资源上，Service Router或API Gateway将负责引导请求进入各服务集群进行逻辑运算。

**4.2.2 电商私有云**

随着电商企业的成长，公有云服务可能不能满足用户的特殊化需求，电商私有云可以提供客户需求的定制化服务，提供整套的解决方案。

从数据中心建设中的方案推荐，到服 务部署实施都可打包对外销售。帮助中型的电商客户快速成长，由于数据全部在客户的数据中心里，免去客户对公有云数据安全性的担忧。

**4.2.3 电商混合云**

混合云模式可以同时拥有公有云和私有云的优势。电商公有云可以快速帮助客户屏蔽掉营销带给基础服务的冲击，可以将面对终端用户的请求量与业务逻辑全部由电商公有云来承载，免去客户对基础设施的持续投资。

与此同时，财务、用户信息等核心数据又可以存留在电商私有云里，不用担心泄露的风险。

通过混合云的方式不仅保障核心业务与数据由企业自己掌控，还保证了特定业务下对资源需求的弹性控制，按量付费，不仅节约成本，还可轻松应对秒杀、抢购等高并发应用场景。

通过全局负载均衡来导流，将请求转发至公有云或私有云，按业务类型单独或者合作，为终端用户提供服务。

**4.3 电商云平台架构**

电商云平台架构如下图所示： 
![图片描述](http://img.blog.csdn.net/20161001083114183)

**SDN:** 软件定义网络（Software Defined Network, SDN ）。将网络设备上的控制权分离出来，由集中的控制器管理，无须依赖底层网络设备（路由器、交换机、防火墙），屏蔽了来自底层网络设备的差异。而控制权是完全开放的，用户可以自定义任何想实现的网络路由和传输规则策略，从而更加灵活和智能。


**流程引擎：**比如一个oa系统，先要找二级部门签，再找一级部门签，最后找Boos签。

**编排服务：**服务间之间是什么关系，谁调用谁，通过什么管理

**账户服务：**就是账户

**产品服务：**就是产品

**JavaContainer：**Tomcat

**PHPContainer：**Apache


**4.3.1 日志收集**

用户通过自助化方式购买日志服务。**日志分析结果将以接口的方式提供给用户**，用户可以按需请求数据或通过乐视云提供的数据可视化服务来监控成交量、用户行为、热销商品等数据。客户通过数据来改进自己的业务流程、调整产品研发方向、改进业务系统服务质量等，达到以数据驱动业务的目的，减少决策失误。

**4.3.2 监控**

监控服务可以基于日志、接口、服务参数等因子进行采集，并且**通过预先设定的阀值，进行不同级别的报警**。目前已支持电话、短信、微信等方式通知客户上线处理。对因子和报警方式都做了抽象，支持不同的组合，灵活可配置。让管理人员对整个系统运行状态了如指掌。

**4.3.3 伸缩**

应用举例：电商购物节 
1） 在预定好电商抢购节之前，及时进行系统的扩容，加强系统的服务能力。 
2） 云平台配合进行压力及伸缩实验，做好峰值的压力测试，帮助企业达到快速便捷的能力扩展。 
3） 在关键流量节点做好资源冗余，核心业务数据确保万无一失。 
4） 在购物节过后，快速进行资源的销毁，帮助企业节省资金。

**4.3.4 流量调度**

上云后，结合电商企业自定义的流量调度机制可以实现更大范围的调度，也可以把流量调度策略放在电商云中，做更无缝的代理功能。流量调度不仅是容灾的考虑，更为了在抢购或者秒杀期间，能抗住前一个小时或者半个小时的海量并发请求。其中包括跨地域、跨机房、集群内的三个层级的流量调度策略。第一层DNS，第二层 负载均衡，第三层Service Router，配合流量卡尺算法和资源池服务能力，灵活变更流量调度策略。使全网能安全度过最初半小时的请求量，完成订单转化。

**4.3.5 计费**

1）按量计费。PaaS层组件按照请求量进行计费，阶梯制进行计费。 
2）服务套餐选择，多服务灵活组合，按套餐计费方式提供。

**4.4 混合云体系及访问数据流示意图**

![图片描述](http://img.blog.csdn.net/20161001083147423)

**先从全局网关进来，有直接进入公有云的，也有进入私有云的，私有云这边有内部业务，核心业务，敏感数据。
进入公有云会做负载均衡，均衡机房1,到机房N。机房间，
服务间通讯（消息队列通信，远程调用通信），数据文件同步（rsync）。
微服务与微服务间的通讯。
服务发现：用zookeeper。
日志收集：从负载均衡到服务发现到服务间通讯等等都需要收集日志。监控：机房1到机房N全都要监控起来。
OOS对象存储：可以放静态资源，静态资源的加速靠CDN，存在于OS的静态文件可以分发到CDN上面。
流量过滤：过滤机器或者危险的请求。
私有云与公有云通过VPC和VPN进行通讯**

**4.5 电商云支持抢购的案例解析** 
![图片描述](http://img.blog.csdn.net/20161001083217731)

抢购活动最基本的技术特征是瞬时高并发，具体举措在用户端到服务端，应用层到基础设施层都有所体现。

**4.5.1 抢购的指导思想**

减少到达服务端的流量 
减少数据库的直接操作 
保证资源冗余 
从应用程序到操作系统等各个层次实施好最小权限原则（安全性保证）

**4.5.2 场景列举及应对方法**

**场景一**： 用户不断刷新页面获取商品信息造成大量访问请求，会占用大量的带宽资源。

**解决办法**：页面尽量静态化，压缩页面内容，优化HTTP头，可以使用乐视CDN做静态加速。一些不必保持全局一致性的元数据，可以使用缓存进行保存。

**全局一致性：**强一致性同步。就比如说买东西的库存，库存还剩多少，这个数值就需要全局一致性。不管什么时候（当库存没发生改变的时候），不管在哪个地方，不管网络好不好，看到的这个值都一样。有些无关紧要的地方，即使错了影响也不大，就不需要全局一致性，可以慢慢的处理，使用缓存进行保存。


**场景二**： CDN解决了静态资源的问题，但仍有大量有效或恶意的请求被转发至服务端，服务器压力很大。

**解决办法**：乐视云盾可进行流量过滤，把非正常流量、无效流量在到达服务端之前清洗掉，可以屏蔽绝大部分DDoS，并接入WAF程序对HTTP请求进行分析，可以有效拦截SQL注入、XSS跨站、获取敏感信息、漏洞利用等常见攻击行为。

请求预处理，通过业务逻辑限制尽早拦截无需继续处理的请求；透传的流量将作用在提前扩容的资源上。

**场景三**：大量要处理的请求导致数据库压力巨大，频繁的操作导致数据库性能低下甚至宕机。

**解决办法**：针对业务设计高效的缓存策略，**热数据利用OCS进行缓存，需全局一致性数据存储在乐视RDS。**

**全局一致性数据存储**：使用具有强制同步功能的数据库，用传统的关系型数据库解决、

**场景四**： 高并发下数据不一致性会导致超卖等情况。

**解决办法**：通过上面请求预处理后已经大大减少了订单的创建和超卖的可能，但超卖还是可能存在的。首先，利用消息队列来缓冲请求，超过设定阈值的请求不处理，直接返回抢购结束。

**比如有1473个库存，但同时有1500个请求过来，就可能发生超卖情况。这时候用消息队列解决,用消息队列缓冲请求**

**消息队列的作用：把数据暂时存起来，之后再取出来。双方不协调的时候，用队列来协调。**
---

**例如，双十一抢购的时候，下单可以先存入消息队列**


其次，利用分布式消息队列来同步商品库存量，操作库存时临时加锁，将库存减扣和订单更新等必要操作封装成事务。

### **5\. 容器技术**

核心：lxcnamespace、cgroup
---

**lxc：linux容器技术**

**namespace：命名空间，程序的运行环境相对独立,其目的是将某个特定的全局系统资源（global system resource）通过抽象方法使得namespace 中的进程看起来拥有它们自己的隔离的全局系统资源实例。换句话说：Linux内核实现namespace的主要目的就是为了实现轻量级虚拟化（容器）服务。在同一个namespace下的进程可以感知彼此的变化，而对外界的进程一无所知。这样就可以让容器中的进程产生错觉，仿佛自己置身于一个独立的系统环境中，以此达到独立和隔离的目的。**

**cgroup：control group，用于限制和隔离一组进程对系统资源的使用。在Cgroup出现之前，只能对一个进程做资源控制，（cgroup可以对任意组进程进行资源控制）。换句话说：cgroup就是一组进程的行为控制。要对某个进程进行资源限制，就将进程添加到cgroup中，一个cgroup可以有多个进程**

**_UFS_（联合文件系统）：文件的复用，一个文件和另一个文件可以组合起来，组合成一个新的文件让别人去使用。然而这俩个文件又可以作为单独的个体被使用。**

**便利性：可以屏蔽底层系统的差异，假如说基础镜像选择centos，在centos上运行一个服务，用docker打包起来。我们就可以把它拿到另外一台机器上去运行，而另一台机器可以是ubuntu等其他系统。而在这ubuntu上可以启动这个基于centos打包起来的镜像，进入这个容器以后，就感觉在centos里面。**

容器技术的出现大大促进了微服务架构和云的发展

但是在同一个操作系统里，就有被入侵的可能。比如A和B在同一个操作机上，但A的权限更大，A就可能访问B的数据。

**5.1 容器技术优势**

更高的资源使用率 
启动销毁的速度快 
结合容器技术可以比较完美的支持水平伸缩业务 

**5.2 容器技术劣势**

隔离性 
容器中对于网络的支持 
下面介绍乐视云平台基于容器的支撑体系。在此体系中，主要包括： Matrix 和 BeeHive两个系统。

**6.1 Matrix & Beehive协同部署示意图**

![图片描述](http://img.blog.csdn.net/20161001083340002)
**6.2 BeeHive资源调度系统**

**6.2.1 BeeHive核心设计思想**

开放 
抽象 
包容 
6.2.2 BeeHive内部结构示意图 
![图片描述](http://img.blog.csdn.net/20161001083416139)

Beehive分为调度抽象层、计算抽象层、网络抽象层、存储抽象层四部分，调度层位于其他三层之上。

可以把这四个抽象都理解为接口，共同完成了对各方面资源及调度能力的抽象，对外为乐视云提供统一的抽象接口提供资源能力输出代理，屏蔽不同容器管理系统的 复杂性和多样性。支持可插拔和多接口适配设计。

Beehive先期为这几层之下都提供了默认实现，后期可以考虑接入业内成型的开源系统，开放包容。在资源 隔离方面，提供内存、CPU、 磁盘IO、网络IO的隔离机制。


**块存储：主要操作对象是磁盘，事先在存储空间中画好整齐的格子（格式化），然后以一个格子为最小单位进行存取，即每次存取至少涉及一个格子的空间。**